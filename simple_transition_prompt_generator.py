#!/usr/bin/env python3
"""
ç®€åŒ–ç‰ˆè½¬åœºæç¤ºè¯ç”Ÿæˆå™¨
ä½¿ç”¨é€šç”¨æ¨¡æ¿ï¼Œä¸ä¾èµ– Claude API
"""

import os
from pathlib import Path
from typing import Optional


class SimpleTransitionPromptGenerator:
    """ç®€åŒ–ç‰ˆè½¬åœºæç¤ºè¯ç”Ÿæˆå™¨"""

    def __init__(self):
        """åˆå§‹åŒ–ç”Ÿæˆå™¨"""
        print(f"âœ… ç®€åŒ–ç‰ˆæç¤ºè¯ç”Ÿæˆå™¨åˆå§‹åŒ–å®Œæˆ")

    def generate_prompt(
        self,
        frame_start_path: str,
        frame_end_path: str,
        content_context: Optional[str] = None
    ) -> str:
        """
        ç”Ÿæˆé€šç”¨è½¬åœºæç¤ºè¯

        Args:
            frame_start_path: èµ·å§‹å¸§å›¾ç‰‡è·¯å¾„
            frame_end_path: ç»“æŸå¸§å›¾ç‰‡è·¯å¾„
            content_context: å†…å®¹ä¸Šä¸‹æ–‡ï¼ˆå¯é€‰ï¼‰

        Returns:
            prompt: è½¬åœºæè¿°æ–‡æœ¬
        """
        print(f"\nğŸ¬ ç”Ÿæˆè½¬åœºæç¤ºè¯...")
        print(f"   èµ·å§‹å¸§: {Path(frame_start_path).name}")
        print(f"   ç»“æŸå¸§: {Path(frame_end_path).name}")

        # ä½¿ç”¨é€šç”¨çš„æ¸å˜æ¯›ç»ç’ƒé£æ ¼è½¬åœºæ¨¡æ¿
        prompt = """é•œå¤´ä»èµ·å§‹é¡µé¢å¼€å§‹ï¼ŒèƒŒæ™¯çš„æå…‰æ³¢æµªä»å·¦å‘å³ç¼“æ…¢æµåŠ¨ï¼Œéœ“è™¹ç´«ã€ç”µå…‰è“å’ŒçŠç‘šæ©™çš„æ¸å˜è‰²å½©åœ¨æ·±è‰²èƒŒæ™¯ä¸Šè½»æŸ”å˜åŒ–ã€‚ç”»é¢ä¸­å¿ƒçš„3Dç»ç’ƒç‰©ä½“å¼€å§‹é€æ¸è§£æ„ï¼Œåˆ†è£‚æˆå¤šä¸ªé€æ˜çš„ç»ç’ƒç¢ç‰‡ï¼Œè¿™äº›ç¢ç‰‡åœ¨ç©ºä¸­ä¼˜é›…åœ°æ—‹è½¬ã€é£˜æ•£ï¼ŒåŒæ—¶åå°„ç€å‘¨å›´çš„éœ“è™¹å…‰èŠ’ã€‚

åœ¨è§£æ„è¿‡ç¨‹ä¸­ï¼Œèµ·å§‹é¡µé¢çš„ä¸»è¦å…ƒç´ é€šè¿‡æ·¡å‡ºæ–¹å¼é€æ¸æ¶ˆå¤±ï¼Œè€Œç›®æ ‡é¡µé¢çš„æ–°å…ƒç´ ä»é€æ˜çŠ¶æ€æ…¢æ…¢æµ®ç°ã€‚å¦‚æœæœ‰ç£¨ç ‚ç»ç’ƒæè´¨çš„åœ†è§’çŸ©å½¢å¡ç‰‡ï¼Œå®ƒä»¬ä»ç”»é¢è¾¹ç¼˜æ»‘å…¥æˆ–ä»ä¸­å¿ƒæ‰©æ•£å‡ºç°ï¼Œè¡¨é¢å¸¦æœ‰å¾®å¦™çš„æ¨¡ç³Šæ•ˆæœå’Œåå…‰ã€‚

ç”»é¢å³ä¾§æˆ–å…¶ä»–åŒºåŸŸçš„ç»ç’ƒç¢ç‰‡é‡æ–°èšåˆï¼Œç¼–ç»‡æˆæ–°çš„3Dç»ç’ƒç»“æ„æˆ–æ•°æ®å¯è§†åŒ–å›¾å½¢ï¼Œè¿™äº›æ–°å…ƒç´ é€šè¿‡æ¸è¿›çš„æ–¹å¼ç»„è£…å®Œæˆï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½ä¿æŒç»ç’ƒæ‹Ÿæ€çš„è´¨æ„Ÿã€‚å¦‚æœæœ‰æ•°æ®æ ‡ç­¾æˆ–æ–‡å­—ä¿¡æ¯ï¼Œå®ƒä»¬é€šè¿‡ç®€å•çš„æ·¡å…¥æ–¹å¼å‡ºç°ï¼Œæ–‡å­—å†…å®¹åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ä¿æŒç»å¯¹æ¸…æ™°ç¨³å®šï¼Œæ²¡æœ‰ä»»ä½•å˜å½¢ã€æ¨¡ç³Šæˆ–æ™ƒåŠ¨ã€‚

èƒŒæ™¯çš„æå…‰æ³¢æµªåœ¨æ•´ä¸ªè½¬åœºè¿‡ç¨‹ä¸­æŒç»­æµåŠ¨ï¼Œè‰²å½©ä»èµ·å§‹é¡µé¢çš„ä¸»è‰²è°ƒå¹³æ»‘è¿‡æ¸¡åˆ°ç›®æ ‡é¡µé¢çš„é…è‰²æ–¹æ¡ˆã€‚æ·±è“ã€ç´«è‰²å’ŒçŠç‘šè‰²çš„æ¸å˜å§‹ç»ˆä¿æŒæŸ”å’Œã€è¿è´¯ï¼Œä¸ºæ•´ä¸ªè½¬åœºè¥é€ å‡ºæµç•…ã€é«˜ç«¯ã€ç§‘æŠ€æ„Ÿçš„è§†è§‰æ°›å›´ã€‚è½¬åœºç»“æŸæ—¶ï¼Œæ‰€æœ‰å…ƒç´ ç¨³å®šåœç•™åœ¨æœ€ç»ˆçŠ¶æ€ï¼Œæ–‡å­—æ¸…æ™°å¯è¯»ï¼Œç»ç’ƒç‰©ä½“å®Œæ•´å‘ˆç°ã€‚"""

        print(f"âœ… è½¬åœºæç¤ºè¯ç”Ÿæˆå®Œæˆï¼")
        print(f"\nè½¬åœºæè¿°ï¼š")
        print(f"{'='*60}")
        print(prompt)
        print(f"{'='*60}\n")

        return prompt

    def generate_preview_prompt(self, first_slide_path: str) -> str:
        """
        ç”Ÿæˆé¦–é¡µé¢„è§ˆè§†é¢‘çš„æç¤ºè¯

        Args:
            first_slide_path: é¦–é¡µå›¾ç‰‡è·¯å¾„

        Returns:
            prompt: é¢„è§ˆè§†é¢‘æç¤ºè¯
        """
        print(f"\nğŸ¬ ç”Ÿæˆé¦–é¡µé¢„è§ˆæç¤ºè¯...")
        print(f"   é¦–é¡µ: {Path(first_slide_path).name}")

        # ä½¿ç”¨é€šç”¨çš„é¢„è§ˆå¾®åŠ¨æ•ˆæ¨¡æ¿
        prompt = """ç”»é¢ä¿æŒé™æ­¢çš„PPTå°é¢æ„å›¾ï¼ŒèƒŒæ™¯çš„æå…‰æ³¢æµªä»¥æå…¶ç¼“æ…¢çš„é€Ÿåº¦ä»å·¦å‘å³æµåŠ¨ï¼Œéœ“è™¹ç´«ã€ç”µå…‰è“å’ŒçŠç‘šæ©™çš„æ¸å˜è‰²å½©å¦‚å‘¼å¸èˆ¬è½»å¾®å˜åŒ–ï¼Œè‰²è°ƒåœ¨5ç§’å†…å®Œæˆä¸€ä¸ªæŸ”å’Œçš„æ˜æš—å¾ªç¯ã€‚

ä¸­å¿ƒçš„3Dç»ç’ƒç‰©ä½“ä¿æŒä¸»ä½“å½¢æ€ä¸å˜ï¼Œä½†å…¶è¡¨é¢åå°„çš„å…‰èŠ’åœ¨ç¼“æ…¢åœ°æµåŠ¨ï¼Œç»ç’ƒæè´¨çš„é«˜å…‰ç‚¹åƒæ°´æ³¢èˆ¬è½»å¾®é—ªçƒï¼Œè¥é€ å‡ºå¾®å¦™çš„å‘¼å¸æ„Ÿã€‚å¦‚æœæœ‰ç£¨ç ‚ç»ç’ƒå¡ç‰‡ï¼Œå…¶è¾¹ç¼˜çš„å…‰æ™•å¼ºåº¦åœ¨0.8åˆ°1.0å€ä¹‹é—´ç»†å¾®æ³¢åŠ¨ã€‚

èƒŒæ™¯æ·±å¤„å¯èƒ½æœ‰å‡ ä¸ªå°å…‰ç‚¹åœ¨é»‘æš—ä¸­ç¼“æ…¢é£˜ç§»ï¼Œå¦‚åŒå®‡å®™ä¸­çš„æ˜Ÿå°˜ã€‚æ•´ä½“ç”»é¢çš„äº®åº¦åœ¨æ­£å¸¸å€¼çš„95%åˆ°105%ä¹‹é—´åšæè½»å¾®çš„å‘¼å¸å¼å˜åŒ–ã€‚æ‰€æœ‰æ–‡å­—å†…å®¹ä¿æŒç»å¯¹æ¸…æ™°ç¨³å®šï¼Œæ²¡æœ‰ä»»ä½•ç§»åŠ¨ã€å˜å½¢æˆ–æ¨¡ç³Šï¼Œå§‹ç»ˆæ¸…æ™°å¯è¯»ã€‚

è¿™æ˜¯ä¸€ä¸ªå¯æ— ç¼å¾ªç¯çš„å¾®åŠ¨æ•ˆï¼Œè§†é¢‘çš„æœ€åä¸€å¸§å’Œç¬¬ä¸€å¸§å®Œç¾è¡”æ¥ï¼Œå…‰æ•ˆçš„æµåŠ¨å’Œè‰²å½©çš„å˜åŒ–å½¢æˆè‡ªç„¶çš„å¾ªç¯ï¼Œç»™äººä»¥é™è°§ã€é«˜ç«¯ã€ç­‰å¾…äº¤äº’çš„æ„Ÿè§‰ã€‚"""

        print(f"âœ… é¢„è§ˆæç¤ºè¯ç”Ÿæˆå®Œæˆï¼")

        return prompt


if __name__ == "__main__":
    """æµ‹è¯•ä»£ç """
    generator = SimpleTransitionPromptGenerator()

    # æµ‹è¯•è½¬åœºæç¤ºè¯
    test_start = "outputs/20260112_012753/images/slide-01.png"
    test_end = "outputs/20260112_012753/images/slide-02.png"

    if os.path.exists(test_start) and os.path.exists(test_end):
        prompt = generator.generate_prompt(test_start, test_end)
        print(f"\nç”Ÿæˆçš„æç¤ºè¯é•¿åº¦: {len(prompt)} å­—ç¬¦")

    # æµ‹è¯•é¢„è§ˆæç¤ºè¯
    if os.path.exists(test_start):
        preview_prompt = generator.generate_preview_prompt(test_start)
        print(f"\nç”Ÿæˆçš„é¢„è§ˆæç¤ºè¯é•¿åº¦: {len(preview_prompt)} å­—ç¬¦")
